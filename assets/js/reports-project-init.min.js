document.addEventListener("DOMContentLoaded", function () {
    fetch("https://app.obbak.es/get_data.php")
    .then(response => response.json())
    .then(data => {
        console.log("Datos recibidos:", data); // 🔍 Verifica en consola
        
        // Verificar si los datos existen y están bien estructurados
        if (!data || !data.categorias || !Array.isArray(data.categorias) || data.categorias.length === 0) {
            console.warn("⚠️ No hay categorías o datos no válidos.");
            return;
        }


        // Configuración de los gráficos
        let options = {
            chart: {
                height: 365,
                type: "area",
                toolbar: { show: false }
            },
            xaxis: {
                categories: data.categorias, // Las categorías provienen de la base de datos
                labels: { style: { fontSize: "11px", colors: "#64748b" } }
            },
            series: [
                { name: "Previsiones Descargas", data: data.tareas }, // Datos de tareas
                { name: "Descargas Reales", data: data.proyectos } // Datos de proyectos
            ],
            stroke: { curve: "smooth" },
            grid: { borderColor: "#ebebf3", strokeDashArray: 3 }
        };

        console.log("Configuración de ApexCharts:", options); // 📌 Depuración

        // Asegúrate de que el contenedor esté presente en el DOM
        const chartContainer = document.querySelector("#project-statistics-chart");

        if (chartContainer) {
            let chart = new ApexCharts(chartContainer, options);
            chart.render();  // Es importante llamar a render() para dibujar el gráfico
        } else {
            console.error("❌ No se encontró el contenedor del gráfico.");
        }
    })
    .catch(error => console.error("❌ Error al obtener datos:", error));
});
